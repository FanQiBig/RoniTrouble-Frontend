# 聊天室界面复刻计划（API 兼容版）

## 目标

将 Robabuny-Frontend 的会话界面和对话界面复刻到当前项目的第三个 tab（好友），取代现有空页面。

## 关键发现

当前项目 API 与 Robabuny-Frontend 完全兼容：

* `GET /privateChat` - 私聊列表

* `POST /message` - 发送消息

* `GET /message/userBox` - 获取消息

* `GET /message` - SSE 消息订阅

* `GET /file` - 文件上传

## 实施步骤

### 1. 复制核心页面

* 将 `Robabuny-Frontend/pages/dialog/dialog.vue` 复制到 `pages/friend/friend.vue`

  * 这是会话列表页面，取代当前空页面

* 将 `Robabuny-Frontend/pages/chat/chat.vue` 复制到 `pages/chat/chat.vue`

  * 这是对话详情页面

### 2. 复制依赖组件

复制到 `components/` 目录：

* `EmojiPanel.vue` - 表情面板

* `MineSidebar.vue` - 侧边栏

* `StatsCard.vue`、`InfoCard.vue`、`Skeleton.vue` - 辅助组件

### 3. 复制工具模块

复制到 `utils/` 目录：

* `messageStore.js` - 本地消息存储

* `QQFace/` 目录 - 表情包数据和工具

* `messageSse.js` - SSE 消息订阅（可选）

### 4. 添加/修改 API

在 `api/` 目录：

* 修改 `api/chat.js`，添加私聊 API：

  ```javascript
  // 使用现有的 request 模块
  export function getPrivateChats() {
    return request.get('/privateChat')
  }

  export function sendTextMessage(conversationId, content, userId) {
    return sendMessage(conversationId, content, 'TEXT')
  }

  export function sendImageMessage(conversationId, content, userId) {
    return sendMessage(conversationId, content, 'IMAGE')
  }

  export function sendFileMessage(conversationId, content, rawFileName, userId) {
    return sendMessage(conversationId, content, 'FILE', rawFileName)
  }

  function sendMessage(conversationId, content, messageType, rawFileName) {
    const payload = {
      content,
      conversationId,
      messageType
    }
    if (rawFileName) payload.rawFileName = rawFileName
    return request.post('/message', payload)
  }
  ```

* 添加 `api/file.js` - 文件上传 API

* 添加 `api/profile.js` - 用户资料 API

* 添加 `api/message.js` - 消息订阅 API

### 5. 复制资源文件

* 复制 `Robabuny-Frontend/assets/wechat_emoji/` 到 `static/wechat_emoji/`

* 复制 `Robabuny-Frontend/static/logo.png` 到 `static/logo.png`（如需要）

### 6. 路径修正

修正所有导入路径：

* `../../api/` → `../api/` 或 `@/api/`

* `../../utils/` → `../utils/` 或 `@/utils/`

* `../../components/` → `../components/` 或 `@/components/`

* 表情包路径调整

### 7. 配置确认

* `pages.json` 中确认 `pages/chat/chat` 路由已配置

* tabBar 中 "好友" 已指向 `pages/friend/friend`

## 注意事项

* 使用当前项目已有的 `request.js` 进行 API 调用

* SSE 消息订阅可能需要根据实际情况调整

* 确保 z-paging 组件已安装（uni\_modules 已有）

